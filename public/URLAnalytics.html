<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>URL Details - short-LS</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f9f9f9;
            color: #333;
        }

        header {
            background: #4f46e5;
            color: #fff;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        main {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #222;
        }

        .card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            text-decoration: none;
        }

        #orgURL:link {
            color: blue;
        }

        th {
            width: 30%;
            color: #555;
            font-weight: normal;
        }

        tr:hover {
            background: #f7f7f7;
        }

        .short-url {
            color: #007bff;
            font-weight: bold;
            /* text-decoration: none; */
        }

        .auth-buttons a {
            text-decoration: none;
            color: white;
            background: #2563eb;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin-left: 0.5rem;
            transition: background 0.3s;
        }

        .auth-buttons a:hover {
            background: #1d4ed8;
        }

        #logoutBtn {
            background-color: rgb(255, 9, 9);
            color: #2563eb;
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid #2563eb;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .execution-btn {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        /* General button styling */
        .execution-btn button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
        }

        .execution-btn .extendBtn {
            background-color: #4caf50;
        }

        .execution-btn .extendBtn:hover {
            background-color: #43a047;
            transform: scale(1.05);
        }

        .execution-btn .deleteBtn {
            background-color: #e53935;
        }

        .execution-btn .deleteBtn:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }

        footer {
            text-align: center;
            padding: 20px;
            background: #f1f1f1;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>

<body>

    <header>
        <h1>short-LS</h1>
        <div class="auth-buttons">
            <a href="/home">Home</a>
            <a id="logoutBtn" href="/logout">Log Out</a>
        </div>
    </header>

    <main>
        <h2>URL Details</h2>
        <div class="card">
            <table>
                <tr>
                    <th>Original URL</th>
                    <td><a href="https://x.com/home" id="orgURL" target="_blank">https://x.com/home</a></td>
                </tr>
                <tr>
                    <th>Short URL</th>
                    <td><a href=/api/r/ id="shortURL" class="short-url" target="_blank">GMwq97fr</a></td>
                </tr>
                <tr>
                    <th>Click Count</th>
                    <td id="clickCount">1</td>
                </tr>
                <tr>
                    <th>Expiration Date</th>
                    <td id="expTime">2025-08-27 16:25:21</td>
                </tr>
                <tr>
                    <th>Created on</th>
                    <td id="createdTime">2025-08-20 16:25:21</td>
                </tr>
                <tr>
                    <th>Last Update</th>
                    <td id="updatedTime">2025-08-25 19:23:42</td>
                </tr>
            </table>
            <div class="execution-btn">
                <button class="extendBtn" id="extendBtn">Extend For 7 Days</button>
                <button class="deleteBtn" id="deleteBtn">Delete</button>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2025 Linkly. All rights reserved.
    </footer>

</body>
<script>
    async function loadDetails() {
        const token = localStorage.getItem("token");
        if (!token) {
            res.status(404).json({ message: "please login first !!" })
            window.location.href = "/login";
        }
        const fullUrl = window.location.pathname.split("/");
        // getting the shortUrl
        const shortUrl = fullUrl[fullUrl.length - 1]
        // console.log(shortUrl)
        let origonalUrl = document.getElementById("orgURL")
        let shortURL = document.getElementById("shortURL")
        let clickCount = document.getElementById("clickCount")
        let expiryTime = document.getElementById("expTime")
        let createdTime = document.getElementById("createdTime")
        let updatedTime = document.getElementById("updatedTime")
        try {
            // sending the details for getting the details of url
            const res = await fetch(`/api/details/${shortUrl}`, {
                method: "GET",
                headers: { "Authorization": "Bearer " + token, }
            })
            const data = await res.json();
            if (data.success) {
                // console.log(data.url)
                let url = `http://localhost:7001/api/r/${data.url.shortUrl}`
                // console.log(url)
                origonalUrl.innerHTML = `${data.url.origonalUrl}`
                shortURL.innerHTML = `http://localhost:7001/api/${data.url.shortUrl}`
                // adding the suitable link for redirection
                shortURL.href = url
                clickCount.innerHTML = `${data.url.clicks}`
                expiryTime.innerHTML = `${new Date(data.url.expirationDate).toLocaleString()}`
                createdTime.innerHTML = `${new Date(data.url.createdAt).toLocaleString()}`
                updatedTime.innerHTML = `${new Date(data.url.updatedAt).toLocaleString()}`
            } else {
                console.log(Error)
            }
        } catch (error) {
            console.log(error)
            console.log(data.message)
        }
    }
    function deleteURL() {
        const token = localStorage.getItem("token");
        if (!token) {
            res.status(404).json({ message: "please login first !!" })
            window.location.href = "/login";
        }
        // if you(me) are watching this. bro! never do the type of api call before adding this eventListner it will delete the urls because of same looking route, its risky.baki tu smjh gayaa na...
        document.getElementById("deleteBtn").addEventListener("click", async function afterWorkings() {
            if (window.confirm("Bro!, Are you sure")) {
                const fullUrl = window.location.pathname.split("/");
                // getting the shortURL
                const shortUrl = fullUrl[fullUrl.length - 1]
                try {
                    // calling the api
                    const response = await fetch(`/api/delete/${shortUrl}`, {
                        method: "DELETE",
                        headers: { "Authorization": "Bearer " + token, }
                    })
                    const dataCheck = await response.json();
                    // if the response done good then this happen,but
                    if (dataCheck.success) {
                        alert(dataCheck.message)
                        window.location.href = "/myURLs"
                        // if the response not done good then this happen
                    } else {
                        console.log("Error occurs while processing your request", data.message)
                    }
                } catch (error) {
                }
            } else {
                // small activity after clicking on the red delete button and if the user reject the confirmation.
                document.getElementById("deleteBtn").innerText = "Okay Brother!!"
                setTimeout(() => {
                    document.getElementById("deleteBtn").innerText = "Delete"
                }, 2000);
            }
        })
    }
    async function extendVal() {
        const token = localStorage.getItem("token");
        if (!token) {
            res.status(404).json({ message: "please login first !!" })
            window.location.href = "/login";
        }
        document.getElementById("extendBtn").addEventListener("click", async () => {
            const fullUrl = window.location.pathname.split("/");
            // getting the shortURL
            const shortUrl = fullUrl[fullUrl.length - 1]
            // console.log(shortUrl)
            try {
                // calling the api
                const response = await fetch(`/api/update/${shortUrl}`, {
                    method: "PUT",
                    headers: { "Authorization": "Bearer " + token, }
                })
                const dataCheck = await response.json();
                // if the response done good then this happen,but
                if (dataCheck.success) {
                    alert(dataCheck.message)
                    console.log(dataCheck.newexpirationDate)
                    document.getElementById("extendBtn")
                    // if the response not done good then this happen
                } else {
                    console.log("Error occurs while processing your request", data.message)
                }
            } catch (error) {
                console.log(error)
                console.log(error.message)
            }
        })
    }
    deleteURL() // calling function
    loadDetails() // calling function
    extendVal() // calling function
</script>

</html>